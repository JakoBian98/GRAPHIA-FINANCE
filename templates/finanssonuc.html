<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ hisse }} | Pro Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;700&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
    :root {
        --bg: #05070a;
        --card: #0f121d;
        --accent: #6366f1;
        --success: #10b981;
        --danger: #f43f5e;
        --warning: #f59e0b;
        --text-main: #f8fafc;
        --text-dim: #94a3b8;
        --border: rgba(255, 255, 255, 0.1);
    }

    body {
        background-color: var(--bg);
        color: var(--text-main);
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 20px;
    }

    .terminal-container {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
    }

    .top-header {
        grid-column: span 3;
        background: linear-gradient(135deg, #0f121d 0%, #1e293b 100%);
        padding: 30px 40px;
        border-radius: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid var(--border);
        margin-bottom: 10px;
    }

    .symbol-box h1 { font-size: 56px; margin: 0; letter-spacing: -3px; font-weight: 800; line-height: 1; }

    .expert-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 12px;
        font-weight: 800;
        font-size: 14px;
        text-transform: uppercase;
        margin-top: 10px;
        border: 1px solid;
    }
    .advice-buy { background: rgba(16, 185, 129, 0.1); color: var(--success); border-color: var(--success); }
    .advice-hold { background: rgba(245, 158, 11, 0.1); color: var(--warning); border-color: var(--warning); }
    .advice-sell { background: rgba(244, 63, 94, 0.1); color: var(--danger); border-color: var(--danger); }
    .advice-none { background: rgba(148, 163, 184, 0.1); color: var(--text-dim); border-color: var(--text-dim); }

    .price-box { text-align: right; }
    .price-val { font-size: 56px; font-weight: 800; color: var(--success); font-family: 'JetBrains Mono'; }

    .score-banner {
        grid-column: span 3;
        background: rgba(255,255,255,0.03);
        border: 1px dashed var(--border);
        border-radius: 16px;
        padding: 15px;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
    }

    .glass-card {
        background: var(--card);
        border-radius: 20px;
        padding: 25px;
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
    }

    .card-title {
        font-size: 13px;
        font-weight: 800;
        color: var(--accent);
        text-transform: uppercase;
        letter-spacing: 1.5px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        padding-bottom: 10px;
    }

    .data-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid rgba(255,255,255,0.03);
    }

    .label { color: var(--text-dim); font-size: 13px; font-weight: 500; }
    .value { font-family: 'JetBrains Mono'; font-weight: 700; font-size: 16px; }

    .full-width-card { grid-column: span 3; }

    .ema-table { width: 100%; border-collapse: collapse; margin-top: 10px; }

    .ema-table th {
        text-align: left;
        color: var(--text-dim);
        font-size: 12px;
        padding: 10px;
        border-bottom: 1px solid var(--border);
    }

    .ema-table td {
        padding: 12px 10px;
        border-bottom: 1px solid rgba(255,255,255,0.02);
        font-family: 'JetBrains Mono';
    }

    .badge-signal {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 800;
        display: inline-block;
        min-width: 80px;
        text-align: center;
    }

    .bg-success-soft { background: rgba(16, 185, 129, 0.2); color: var(--success); }
    .bg-danger-soft { background: rgba(244, 63, 94, 0.2); color: var(--danger); }
    .bg-warning-soft { background: rgba(245, 158, 11, 0.2); color: var(--warning); }

    .status-box {
        margin-top: 15px;
        padding: 12px;
        border-radius: 10px;
        font-size: 12px;
        line-height: 1.4;
        font-weight: 600;
    }
    .status-neutral { background: rgba(99, 102, 241, 0.1); border-left: 4px solid var(--accent); color: #cbd5e1; }
    .status-success { background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--success); color: #6ee7b7; }
    .status-danger { background: rgba(244, 63, 94, 0.1); border-left: 4px solid var(--danger); color: #fda4af; }
    .status-warning { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning); color: #fcd34d; }

    /* AI Analiz Notu Özel Stil */
    .ai-note-content {
        font-size: 15px;
        line-height: 1.6;
        color: #e2e8f0;
        white-space: pre-line;
    }

    /* ARBİTRAJ BÖLÜMÜ (Genel Stiller - Düzeltildi) */
    .arbitrage-card {
        grid-column: span 3;
        background: linear-gradient(135deg, #1e1b4b 0%, #0f121d 100%);
        border: 1px solid rgba(99, 102, 241, 0.3);
    }

    .arb-table {
        width: 100%;
        margin-top: 15px;
        border-radius: 12px;
        overflow: hidden;
    }

    .arb-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        padding: 12px 15px;
        background: rgba(255,255,255,0.03);
        margin-bottom: 5px;
        border-radius: 8px;
        align-items: center;
    }

    .arb-badge-success {
        background: var(--success);
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
    }

    .btn-new {
        grid-column: span 3;
        background: var(--accent);
        color: white;
        text-align: center;
        padding: 20px;
        border-radius: 15px;
        text-decoration: none;
        font-weight: 800;
        margin-top: 20px;
        transition: 0.3s;
    }
    .btn-new:hover { opacity: 0.9; transform: translateY(-2px); }

    /* MOBİL UYUMLULUK */
    @media (max-width: 1100px) {
        .terminal-container { grid-template-columns: 1fr 1fr; }
        .top-header, .score-banner, .btn-new, .full-width-card, .arbitrage-card { grid-column: span 2; }
    }
</style>
</head>
<body>

    <div class="terminal-container">

        <header class="top-header">
            <div class="symbol-box">
                <span style="color: var(--accent); font-weight: 800; font-size: 12px; letter-spacing: 2px;">PRO TERMİNAL ANALİZİ</span>
                <h1>{{ long_name if long_name else hisse }}</h1>
                <div style="font-size: 14px; color: var(--text-dim); margin-top: 10px;">
                    <i class="fas fa-calendar-alt"></i> {{ tarih }} | <i class="fas fa-globe"></i> {{ web_site }}
                </div>
            </div>
            <div class="price-box">
                <span style="color: var(--text-dim); font-weight: 700; font-size: 14px;">GÜNCEL FİYAT</span>
                <div class="price-val">{{ "{:,.2f}".format(kapanıs) }}</div>

                <div class="expert-badge
                    {% if tavsiye == 'buy' or tavsiye == 'strong_buy' %}advice-buy
                    {% elif tavsiye == 'hold' %}advice-hold
                    {% elif tavsiye == 'sell' or tavsiye == 'underperform' %}advice-sell
                    {% else %}advice-none{% endif %}">
                    <i class="fas fa-user-tie"></i> UZMAN TAVSİYESİ: {{ tavsiye if tavsiye else 'VERİ YOK' }}
                </div>
            </div>
        </header>

        <div class="score-banner">
            <i class="fas fa-shield-alt" style="font-size: 24px; color: var(--{{ renk if renk != 'succes' else 'success' }});"></i>
            <span style="font-weight: 700; font-size: 18px;">GÜVEN ENDEKSİ:</span>
            <span style="font-weight: 800; font-size: 20px; color: var(--{{ renk if renk != 'succes' else 'success' }});">{{ güven_mesajı }}</span>
        </div>


    <div class="glass-card">
    <div class="card-title"><i class="fas fa-building"></i> Künye & Verimlilik</div>
    <div class="data-row"><span class="label">Kuruluş / H.Arz</span><span class="value">{{ kuruluş_yılı if kuruluş_yılı else 'N/A' }} / {{ halka_arz_tarihi if halka_arz_tarihi else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">Halka Arz Fiyatı</span><span class="value">{{ halka_arz_fiyatı if halka_arz_fiyatı else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">Çalışan Sayısı</span><span class="value">{{ "{:,.0f}".format(çalışan_sayısı) if çalışan_sayısı else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">Gelir / Çalışan</span><span class="value">{{ gelir_bölü_çalışan if gelir_bölü_çalışan else 'N/A' }}</span></div>
    <div class="status-box status-neutral">{{ adres if adres else 'Adres Bilgisi Mevcut Değil' }}</div>
</div>

<div class="glass-card">
    <div class="card-title"><i class="fas fa-chart-line"></i> Teknik Radar</div>
    <div class="data-row"><span class="label">ATH (Zirve)</span><span class="value">{{ "{:,.2f}".format(ath) if ath else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">Zirveden Uzaklık</span><span class="value" style="color: var(--danger);">{% if zirveden_uzaklık %}%{{ "%.2f"|format(zirveden_uzaklık) }}{% else %}N/A{% endif %}</span></div>
    <div class="data-row"><span class="label">Günlük Hacim</span><span class="value">{{ "{:,.0f}".format(hacim) if hacim else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">Beta</span><span class="value">{{ beta if beta else 'N/A' }}</span></div>
    <div class="status-box status-neutral">PİYASA İŞTAHI: {{ indikatör if indikatör else 'Belirlenemedi' }}</div>
</div>

<div class="glass-card">
    <div class="card-title"><i class="fas fa-percentage"></i> Çarpanlar & Kar</div>
    <div class="data-row"><span class="label">F/K Oranı</span><span class="value">{{ "%.2f"|format(fk) if fk else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">PEG Durumu</span><span class="value">{{ peg_durum if peg_durum else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">FAVÖK (EBITDA)</span><span class="value">{{ FAVÖK if FAVÖK else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">Hisse Başına Kar</span><span class="value">{{ hisse_başına_kar if hisse_başına_kar else 'N/A' }}</span></div>
    <div class="data-row">
        <span class="label">Net Kar Marjı</span>
        <span class="value">
            {% if net_kar_marjı is not none %}
                %{{ "%.2f"|format(net_kar_marjı * 100) }}
            {% else %}
                N/A
            {% endif %}
        </span>
    </div>
</div>

<div class="glass-card">
    <div class="card-title"><i class="fas fa-heartbeat"></i> Mali Sağlık</div>
    <div class="data-row"><span class="label">Cari Oran</span><span class="value">{{ cari_oran if cari_oran else 'N/A' }}</span></div>
    <div class="data-row"><span class="label">Borç / Özkaynak</span><span class="value">{{ borç_bölü_özkaynak_oran if borç_bölü_özkaynak_oran else 'N/A' }}</span></div>
    <div class="data-row">
        <span class="label">Özkaynak Karlılığı</span>
        <span class="value">{% if oz_kaynak_karlılığı %}%{{ "%.2f"|format(oz_kaynak_karlılığı) }}{% else %}N/A{% endif %}</span>
    </div>
    <div class="data-row"><span class="label">Defter Değeri</span><span class="value">{{ defter_değeri if defter_değeri else 'N/A' }}</span></div>
    <div class="status-box status-neutral" style="color: var(--success);">{{ cari_durum if cari_durum else 'Veri Yok' }}</div>
</div>
    <div class="glass-card">
        <div class="card-title"><i class="fas fa-bullseye"></i> Hedefler & Bilanço</div>
        <div class="data-row">
    <span class="label">Analist Hedefi</span>
    <span class="value" style="color: var(--warning);">
        {{ "{:,.2f}".format(hedef_fiyat) if hedef_fiyat is not none else 'N/A' }}
    </span>
</div>

<div class="data-row">
    <span class="label">Potansiyel</span>
    <span class="value" style="color: var(--success);">
        {% if potansiyel is not none %}
            + %{{ "%.2f"|format(potansiyel) }}
        {% else %}
            N/A
        {% endif %}
    </span>
</div>
        <div class="data-row"><span class="label">Bilanço Tarihi</span><span class="value">{{ bilanço_tarihi }}</span></div>
        <div class="data-row"><span class="label">Beklenti</span><span class="value">{{ bilanço_beklenti }}</span></div>
        <div class="status-box status-neutral">Market Cap: {{ market_cap if market_cap else 'N/A' }}</div>
    </div>

        <div class="glass-card full-width-card">
            <div class="card-title">
                <i class="fas fa-microchip"></i> TEKNİK ANALİZ RADARI (EMA vs SMA KARŞILAŞTIRMASI)
            </div>
            <div style="overflow-x: auto;">
                <table class="ema-table">
                    <thead>
                        <tr>
                            <th>PERİYOT</th>
                            <th>EMA DEĞERİ</th>
                            <th>EMA SİNYAL</th>
                            <th>SMA SİNYAL</th>
                            <th>FİYAT KONUMU</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in ema_listesi %}
                        <tr>
                            <td><span style="color: var(--accent); font-weight: 700;">{{ item.periyot }}</span></td>
                            <td>{{ "{:,.2f}".format(item.deger) }}</td>
                            <td>
                                <span class="badge-signal
                                    {% if item.renk|lower == 'success' or item.renk|lower == 'succes' %}bg-success-soft
                                    {% elif item.renk|lower == 'danger' %}bg-danger-soft
                                    {% else %}bg-warning-soft{% endif %}">
                                    {{ item.sinyal_ema }}
                                </span>
                            </td>
                            <td>
                                <span class="badge-signal
                                    {% if item.sma_renk|lower == 'success' or item.sma_renk|lower == 'succes' %}bg-success-soft
                                    {% elif item.sma_renk|lower == 'danger' %}bg-danger-soft
                                    {% else %}bg-warning-soft{% endif %}">
                                    {{ item.sinyal_sma }}
                                </span>
                            </td>
                            <td>
                                {% if kapanıs > item.deger %}
                                <i class="fas fa-chevron-up" style="color: var(--success);"></i> Üzerinde
                                {% else %}
                                <i class="fas fa-chevron-down" style="color: var(--danger);"></i> Altında
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="status-box status-neutral" style="margin-top: 20px;">
                <i class="fas fa-info-circle"></i>
                <strong>Analiz Notu:</strong>
                Fiyatın en uzun vade olan EMA-200 ({{ ema_sözlük['EMA-200'] if ema_sözlük and 'EMA-200' in ema_sözlük else 'N/A' }}) üzerinde olması, ana trendin boğa piyasasında olduğunu doğrular.
            </div>
        </div>

        <div class="glass-card arbitrage-card">
    <div class="card-title">
        <i class="fas fa-shuffle" style="color: #818cf8;"></i>
        ÇOKLU BORSA ARBİTRAJ RADARI
        {% if not arbitraj_sonuc.is_available %}<small style="color: var(--text-dim); text-transform: none; margin-left: 10px;">(Devre Dışı)</small>{% endif %}
    </div>

    {% if arbitraj_sonuc.is_available %}
        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; flex-wrap: wrap;">

            <div style="flex: 1; min-width: 300px;">
                <div class="status-box status-success" style="font-size: 14px; padding: 20px;">
                    <div style="margin-bottom: 10px; font-weight: 800; color: white;">
                        <i class="fas fa-fire"></i> {{ arbitraj_sonuc.best_deal.not }}
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 13px;">
                        <div>Alış: <strong>{{ arbitraj_sonuc.best_deal.buy_from }}</strong></div>
                        <div>Satış: <strong>{{ arbitraj_sonuc.best_deal.sell_to }}</strong></div>
                        <div>Net Kar: <span style="color: #6ee7b7;">%{{ arbitraj_sonuc.best_deal.net_yuzde }}</span></div>
                        <div>Transfer Fee: <span>${{ arbitraj_sonuc.best_deal.fee_usd }}</span></div>
                    </div>
                </div>
            </div>

            <div style="flex: 2; min-width: 300px;">
                <div class="arb-table">
                    {% for item in arbitraj_sonuc.all_prices %}
                    <div class="arb-row">
                        <div style="font-weight: 700;">
                            <i class="fas fa-landmark" style="margin-right: 8px; color: var(--accent);"></i>
                            {{ item.exchange }}
                        </div>
                        <div style="font-family: 'JetBrains Mono'; color: var(--text-main);">${{ "{:,.4f}".format(item.price) }}</div>
                        <div style="text-align: right;">
                            {% if item.exchange == arbitraj_sonuc.best_deal.buy_from %}
                                <span class="arb-badge-success">EN UCUZ</span>
                            {% elif item.exchange == arbitraj_sonuc.best_deal.sell_to %}
                                <span class="arb-badge-success" style="background: var(--accent);">EN PAHALI</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% else %}
        <div class="status-box status-neutral" style="padding: 20px; text-align: center;">
            <i class="fas fa-info-circle" style="font-size: 20px; margin-bottom: 10px; display: block;"></i>
            {{ arbitraj_sonuc.not }}
        </div>
    {% endif %}
</div>

        <div class="glass-card full-width-card" style="background: linear-gradient(to bottom right, #0f121d, #161b2e);">
            <div class="card-title">
                <i class="fas fa-robot" style="color: #818cf8;"></i> YAPAY ZEKA DERİN ANALİZ NOTLARI
            </div>
            <div class="ai-note-content">
                {{ ai_analiz_notu | safe }}
            </div>
        </div>

        <a href="/" class="btn-new"><i class="fas fa-search"></i> YENİ SORGULAMA YAP</a>
    </div>

</body>
</html>
